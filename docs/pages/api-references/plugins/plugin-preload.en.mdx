import { APITable } from "../../../components/APITable";

# `@stackflow/plugin-preload`

`@stackflow/plugin-preload` is useful when you need to load remote data before rendering the activity.

## Installation

```bash npm2yarn copy
npm install @stackflow/plugin-preload
```

## Usage

```ts showLineNumbers filename="stackflow.ts" copy
import { stackflow } from "@stackflow/react";
import { preloadPlugin } from "@stackflow/plugin-preload";
import { MyHome } from "./MyHome";
import { MyArticle } from "./MyArticle";
import { NotFoundPage } from "./NotFoundPage";

const { Stack, useFlow, activities } = stackflow({
  activities: {
    MyHome,
    MyArticle,
    NotFoundPage,
  },
  plugins: [
    // ...
    preloadPlugin({
      loaders: {
        MyHome({ activityParams }) {
          // implement your own preload function using activity information
          // when activity pushed, loader is automatically triggered before rendering
        },
        MyArticle() {
          // ...
        },
        NotFoundPage() {
          // ...
        },
      },
    }),
  ],
});

export type TypeActivities = typeof activities;
```

```ts showLineNumbers filename="usePreloader.ts" copy {4}
import { createPreloader } from "@stackflow/plugin-preload";
import type { TypeActivities } from "./stackflow";

export const { usePreloader } = createPreloader<TypeActivities>();
```

```tsx showLineNumbers filename="MyComponent.tsx" copy {8}
import { usePreloader } from "./usePreloader";

const MyComponent = () => {
  const { preload } = usePreloader();

  useEffect(() => {
    // imperatively preload
    preload("MyArticle", {
      /* ... */
    });
  }, []);

  return <div>{/* ... */}</div>;
};
```

## Reference

### `preloadPlugin`

<APITable>
|        |                                                       |                                                                                                                            |
| ------ | ----------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| options| `PreloadPluginOptions<T>`                             | Options object containing loaders for each activity, mapping activity names to their respective preloading logic.            |
| loaders| `{ [key in Extract<keyof T, string>]: Loader<U> }`    | A mapping of activity names to their respective loader functions, defining how to preload the activity's data or resources.  |
| loader | `(params: { activityParams, activityContext }) => any`| A function that executes preloading logic, potentially returning a reference (preloadRef) to the preloaded data.             |
</APITable>

### `createPreloader`
<APITable>
|                   |                                                              |                                                                                            |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------------------------------------ |
| usePreloader      | `() => { preload: PreloadFunc<T> }`                          | A hook that returns an object containing a `preload` function for preloading activities.    |
</APITable>

### `usePreloader`

<APITable>
|                   |                                                              |                                                                                            |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------------------------------------ |
| PreloadFunc       | `(activityName, activityParams, options) => any;` | Function that preloads data or resources for a specified activity, given its name and parameters, with optional context. |
| usePreloaderOptions| `{ urlPatternOptions?: UrlPatternOptions }`                 | Options for customizing URL pattern matching within the preloader function.                 |
| activityName      | `K`, extracted from keys of T                                | The name of the activity for which to preload resources.                                    |
| activityParams    | `T[K] extends ActivityComponentType<infer U> ? U : {}`       | Parameters specific to the activity, used for URL pattern filling and in the loader function. |
| options           | `{ activityContext?: {} }` (optional)                        | Optional context information to be passed to the loader when preloading resources for the activity. |
</APITable>